#!/usr/bin/haserl
<%in /usr/lib/web/libweb.sh %>
<% session_validate %>
<% response_headers %>

<%
xml_3g_PPP_Connection=`config_read /config/network/ap_3g_wan/PPP_Connection_Mode`
xml_connect_mode=`config_getoption "$xml_3g_PPP_Connection" connect_mode`
xml_connect_status=`config_getoption "$xml_3g_PPP_Connection" connect_status`

xml_3g_apn=`config_read /config/network/ap_3g_wan/APN`
xml_apn_mode=`config_getoption "$xml_3g_apn" apn_mode`
xml_apn_content=`config_getoption "$xml_3g_apn" apn_content`

xml_3g_Dial_setting=`config_read /config/network/ap_3g_wan/Dial_setting`
xml_Dial_NO=`config_getoption "$xml_3g_Dial_setting" Dial_NO`

xml_3g_PDP=`config_read /config/network/ap_3g_wan/PDP`
xml_PDP_type=`config_getoption "$xml_3g_PDP" PDP_type`
xml_PDP_mode=`config_getoption "$xml_3g_PDP" PDP_mode`
xml_PDP_address=`config_getoption "$xml_3g_PDP" PDP_address`

xml_3g_PPP_Auth=`config_read /config/network/ap_3g_wan/PPP_Auth`
xml_auth_mode=`config_getoption "$xml_3g_PPP_Auth" auth_mode`
xml_user_name=`config_getoption "$xml_3g_PPP_Auth" user_name`
xml_passwd=`config_getoption "$xml_3g_PPP_Auth" passwd`

xml_3g_PPP_setting=`config_read /config/network/ap_3g_wan/PPP_setting`
xml_idle_time_enable=`config_getoption "$xml_3g_PPP_setting" idle_time_enable`
xml_max_idle_time=`config_getoption "$xml_3g_PPP_setting" max_idle_time`
xml_MTU=`config_getoption "$xml_3g_PPP_setting" MTU`

xml_3g_DNS=`config_read /config/network/ap_3g_wan/DNS`
xml_dns_mode=`config_getoption "$xml_3g_DNS" dns_mode`
xml_Primary_dns=`config_getoption "$xml_3g_DNS" Primary_dns`
xml_second_dns=`config_getoption "$xml_3g_DNS" second_dns`

pppd_status=`ps|awk '/pppd/'`
if [ -z "$pppd_status" ]; then
	pppd_status="Disconnected"
else
	pppd_status="Connected"
fi
%>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>WAN Connection</title>
<link rel="stylesheet" href="style.css" type="text/css"/>
<script language="javascript" src="JAS.js">
</script>
<script language="javascript">
	var ppp_status="<%= $pppd_status %>";
function init_3g_wan()
{
	document.getElementById("manual_apn_tr").style.display = "none";
	document.getElementById("ppp_click_show").style.display = "none";
	document.getElementById("pri_dns").style.display = "none";
	document.getElementById("second_dns").style.display = "none";
	document.getElementById("manual_pdp_tr").style.display = "none";
	if(ppp_status == "Connected" )
	{
		document.all.connect_status.value = "Connected";
		document.all.connect_ppp.value="disconnect";
	}
	else
	{
		document.all.connect_status.value = "Disconnected";
		document.all.connect_ppp.value="connect";
	}
}
function display_click()
{
	if(document.all.apn_setting[0].checked == true )
		document.getElementById("manual_apn_tr").style.display = "none";
	else if(document.all.apn_setting[1].checked == true )
		document.getElementById("manual_apn_tr").style.display = "";
		
	if(document.all.idle_time_setting[0].checked == true )
		document.getElementById("ppp_click_show").style.display = "";
	else if(document.all.idle_time_setting[1].checked == true )
		document.getElementById("ppp_click_show").style.display = "none";
		
	if(document.all.dns[0].checked == true )
	{
		document.getElementById("pri_dns").style.display = "none";
		document.getElementById("second_dns").style.display = "none";
	}
	else if(document.all.dns[1].checked == true )
	{
		document.getElementById("pri_dns").style.display = "";
		document.getElementById("second_dns").style.display = "";
	}
	
	if(document.all.pdp_setting[0].checked == true )
		document.getElementById("manual_pdp_tr").style.display = "none";
	else if(document.all.pdp_setting[1].checked == true )
		document.getElementById("manual_pdp_tr").style.display = "";
}

function pppconnect_display()
{
	if(document.all.connect_ppp.value == "connect" )
	{
		document.all.connect_status.value="Connected";
	}
	else
	{
		document.all.connect_status.value="Disconnected";
	}
	
}

function get_mode()
{
	if(document.all.ppp_connct_mode[0].checked == true)
	{
		document.all.ppp_connect_mode.value="Auto_connect";
	}
	else if(document.all.ppp_connct_mode[1].checked == true)
	{
		document.all.ppp_connect_mode.value="Demand_connct";
	}
	else
	{
		document.all.ppp_connect_mode.value="Manual_connct";
	}
	
}
function myrefresh()
{
   document.form_refresh.action="action.cgi";
	 document.form_refresh.submit(); 
}
setTimeout("myrefresh()",20000)
</script>
</head>

<body bgcolor="#efefef" onload='init_3g_wan();display_click()'>
<table width="100%" border="0">
  <tr>
    <td background="orange/right-up.jpg" style="padding-left:30px">
	  <table border="0">
        <tr>
          <td class="top1"><a href="wan_status.htm" target="MainFrame">Status</a></td>
          <td class="top1">3G WAN Setting</td>
		  <td class="top1"><a href="802.11_wan_setting.htm" target="MainFrame">802.11 WAN Setting</a></td>
		  <td class="top1"><a href="wan_selection.htm" target="MainFrame">WAN selection</a></td>
        </tr>
      </table>
	</td>
  </tr>
  <tr>
    <td background="orange/right-down.jpg" class="top2">WAN Setting -->3G WAN Connection</td>
  </tr>
</table>
<div style="padding-top:20px; padding-left:70px">
<table width="500" border="0">
<!///////////////////////////////////////////////CONNECT/////////////////////////////////////////////////////////////////-->  
  <form name="form0" method="post" action="<%= $action_cgi %>" onsubmit="return pppconnect_display()">
  <tr id="wizard1">
    <td>
	<table width="500" border="0" class="main">
	
	  <tr>
	    <td><font class="table_head" title="PPP Connection Mode illustration">PPP Connection Mode</font></td>
	  </tr>
  
	  <tr>
	    <td style="padding-top:5px; padding-bottom:10px">
		  <table width="500" border="0" class="main" bgcolor="#FFFFFF">
		    <tr>
	          <td class="td_style" width="150"><input type="radio" name="ppp_connct_mode" <% webui_radiobutton_check "$xml_connect_mode" "Auto_connect" %> value="Auto_connect" onclick="get_mode()"></td>
	          <td class="td_style" width="350">Auto Connect </td>
	        </tr>
			<tr>
	          <td class="td_style"><input type="radio" name="ppp_connct_mode" <% webui_radiobutton_check "$xml_connect_mode" "Demand_connct" %> value="Demand_connct" onclick="get_mode()"></td>
	          <td class="td_style">On Demand Connect </td>
	        </tr>
			<tr>
	          <td class="td_style"><input type="radio" name="ppp_connct_mode" <% webui_radiobutton_check "$xml_connect_mode" "Manual_connct" %> value="Manual_connct" onclick="get_mode()"></td>
	          <td class="td_style">Manual Connect</td>
	        </tr>
			<tr height="23">
	          <td class="td_style">PPP Connection Status </td>
	          <td class="td_style">
	          <%= $pppd_status  %> &nbsp;&nbsp;&nbsp;&nbsp;
	          <input type="submit" name="connect_ppp" value="connect" >
	          </td>
	        </tr>
		  </table>
		</td>
	  </tr>
	  
	  </table></td></tr>
	  <input type="hidden" name="connect_status" value="<%= $xml_connect_status  %>">
	  <input type="hidden" name="SERVLET" value="pppconnect">

</form>	  
<form name="form_refresh" method="post" action="<%= $action_cgi %>">
	<input type="hidden" value="wan3g refresh" name="SERVLET">
	</form>  
<form name="form0" method="post" action="<%= $action_cgi %>" >  
<!///////////////////////////////////////////////APN/////////////////////////////////////////////////////////////////-->  
  
<tr id="wizard2" >
    <td>
	<table width="500" border="0" class="main">
        <tr>
          <td><font class="table_head" >APN</font></td>
        </tr>
        <tr>
          <td style="padding-top:5px; padding-bottom:10px">
	        <table width="500" border="0" class="main" bgcolor="#FFFFFF">
	          <tr>
                <td class="td_style" width="150">APN Setting </td>
                <td class="td_style" width="350">
				  <table width="350" border="0">
                    <tr>
                      <td width="80"><input type="radio" name="apn_setting" <% webui_radiobutton_check "$xml_apn_mode" "auto_apn" %> value="auto_apn" onClick="display_click()"/>Auto APN</td>
                      <td width="270"><input type="radio" name="apn_setting" <% webui_radiobutton_check "$xml_apn_mode" "manual_apn" %> value="manual_apn" onClick="display_click()"/>Manual APN</td>
                    </tr>
                  </table>				  
				</td>
              </tr>
		      		<tr id=manual_apn_tr>
                <td class="td_style">APN</td>
                <td class="td_style"><input type="text" name="apn" value="<%= $xml_apn_content  %>" style="height:12px" /></td>
              </tr>
              <tr>
                <td colspan=2><input type=hidden></td>
              </tr>
	        </table>
	      </td>
        </tr>
        <tr>
          <td><font class="table_head" >Dial Setting</font></td>
        </tr>
        <tr>
          <td style="padding-top:5px; padding-bottom:10px">
	        <table width="500" border="0" class="main" bgcolor="#FFFFFF">
	          <tr>
                <td class="td_style" width="135">Dial NO. </td>
                <td class="td_style" width="355"><input type="text" name="dial_num"  style="height:12px" value="<%= $xml_Dial_NO  %>"/></td>
              </tr>
	        </table>
	      </td>
        </tr>
        <tr>
          <td><font class="table_head" title="PDP Type illustration">PDP Type</font></td>
        </tr>
        <tr>
          <td style="padding-top:5px; padding-bottom:10px">
	        <table width="500" border="0" class="main" bgcolor="#FFFFFF">
	          <tr>
                <td class="td_style" width="150">PDP Type </td>
                <td class="td_style" width="350">
				  <table width="350" border="0">
                    <tr>
                      <td width="80"><input type="radio" <% webui_radiobutton_check "$xml_PDP_type" "ip" %> name="pdp_type" value="ip"/>IP</td>
                      <td width="270"><input type="radio" <% webui_radiobutton_check "$xml_PDP_type" "ppp" %> name="pdp_type" value="ppp"/>PPP</td>
                    </tr>
                  </table>
				</td>
              </tr>
	        </table>
	      </td>
        </tr>
        <tr>
          <td><font class="table_head" >PDP</font></td>
        </tr>
        <tr>
          <td style="padding-top:5px; padding-bottom:10px">
	        <table width="500" border="0" class="main" bgcolor="#FFFFFF">
	          <tr>
                <td class="td_style" width="150">PDP Setting </td>
                <td class="td_style" width="350">
				  			<table width="350" border="0">
                    <tr>
                      <td width="80"><input type="radio" name="pdp_setting" <% webui_radiobutton_check "$xml_PDP_mode" "auto_pdp" %> value="auto_pdp" onClick="display_click()"/>Auto PDP</td>
                      <td width="270"><input type="radio" name="pdp_setting" <% webui_radiobutton_check "$xml_PDP_mode" "manual_pdp" %> value="manual_pdp" onClick="display_click()"/>Manual PDP</td>
                    </tr>
                  </table>
				</td>
              <tr id=manual_pdp_tr>
                <td class="td_style">PDP Address</td>
                <td class="td_style"><input type="text" name="pdp_address" value="<%= $xml_PDP_address %>" style="height:12px" /></td>
              </tr>
              <tr>
                <td colspan=2><input type=hidden></td>
              </tr>
	        </table>
	      </td>
        </tr>
      </table>
	</td>
  </tr>
<!///////////////////////////////////////////////PPP/////////////////////////////////////////////////////////////////-->  
  
  <tr id="wizard3" >
    <td>
	<table width="500" border="0" class="main">
        <tr>
          <td><font class="table_head" >PPP Authentication</font></td>
        </tr>
        <tr>
          <td style="padding-top:5px; padding-bottom:10px">
	        <table width="500" border="0" class="main" bgcolor="#FFFFFF">
	          <tr>
                <td class="td_style" width="150">Authentication</td>
                <td class="td_style" width="350">
				  <table width="350" border="0">
                    <tr>
                      <td width="60"><input type="radio" name="authentication" <% webui_radiobutton_check "$xml_auth_mode" "chap" %> value="chap"/>CHAP</td>
                      <td width="290"><input type="radio" name="authentication" <% webui_radiobutton_check "$xml_auth_mode" "pap" %> value="pap"/>PAP</td>
                    </tr>
                  </table>				  
				</td>
              </tr>
		      <tr>
                <td class="td_style">User Name </td>
                <td class="td_style"><input type="text" name="user_name" value="<%= $xml_user_name %>" style="height:12px; width:90px"/></td>
              </tr>
			  <tr>
                <td class="td_style">Password</td>
                <td class="td_style"><input type="text" name="password" value="<%= $xml_passwd %>" style="height:12px; width:90px"/></td>
              </tr>
	        </table>
	      </td>
        </tr>
        <tr>
          <td><font class="table_head" >PPP Setting</font></td>
        </tr>
        <tr>
          <td style="padding-top:5px; padding-bottom:10px">
	        <table width="500" border="0" class="main" bgcolor="#FFFFFF">
	          <tr>
                <td class="td_style" width="135">Idle Time Setting</td>
                <td class="td_style" width="355">
				  <table width="350" border="0">
                    <tr>
                      <td width="60"><input type="radio" name="idle_time_setting" <% webui_radiobutton_check "$xml_idle_time_enable" "enable" %> value="enable" onClick="display_click()"/>Enable</td>
                      <td width="290"><input type="radio" name="idle_time_setting" <% webui_radiobutton_check "$xml_idle_time_enable" "disable" %> value="disable" onClick="display_click()"/>Disable</td>
                    </tr>
                  </table>	
				</td>
              </tr>
              <tr id=ppp_click_show>
                <td class="td_style" width="135">Max Idle Time</td>
                <td class="td_style" width="355"><input type="text" name="max_idle_time" value="<%= $xml_max_idle_time%>" style="height:12px; width:90px"/></td>
              </tr>
			  			<tr>
                <td class="td_style" width="135">MTU</td>
                <td class="td_style" width="355"><input type="text" name="mtu" value="<%= $xml_MTU%>" style="height:12px; width:90px"/></td>
              </tr>
	        </table>
	      </td>
        </tr>
      </table>
	</td>
  </tr>
  
<!///////////////////////////////////////////////DNS/////////////////////////////////////////////////////////////////-->  
  
  <tr id="wizard4" >
    <td><table width="500" border="0" class="main">
        <tr>
          <td><font class="table_head" >DNS</font></td>
        </tr>
        <tr>
          <td style="padding-top:5px; padding-bottom:10px">
	        <table width="500" border="0" class="main" bgcolor="#FFFFFF">
	          <tr>
                <td class="td_style" width="150">DNS</td>
                <td class="td_style" width="350">
				  				<table width="350" border="0">
                    <tr>
                      <td width="80"><input type="radio" name="dns" <% webui_radiobutton_check "$xml_dns_mode" "auto_dns" %> value="auto_dns" onClick="display_click()"/>Auto DNS</td>
                      <td width="270"><input type="radio" name="dns" <% webui_radiobutton_check "$xml_dns_mode" "manual_dns" %> value="manual_dns" onClick="display_click()"/>Manual DNS</td>
                    </tr>
                  </table>				  
								</td>
            </tr>
           <tr id=pri_dns>
             <td class="td_style" width="135">Primary DNS</td>
             <td class="td_style" width="355"><input type="text" name="primary_dns" style="height:12px; width:90px" value="<%= $xml_Primary_dns %>"/></td>
           </tr>
           <tr id=second_dns>
             <td class="td_style" width="135">Secondary DNS DNS</td>
             <td class="td_style" width="355"><input type="text" name="secondary_dns" style="height:12px; width:90px" value="<%= $xml_second_dns %>"/></td>
          </tr>
          <tr><td colspan=2><input type=hidden></td></tr>
          
	        </table>
	      </td>
        </tr>
      </table></td>
  </tr>
  
  
  <tr>
    <td><input id="but" type="submit" name="3g_wan_commit" value="Submit"/></td>
  </tr>
  <input type="hidden" value="3G wan setting" name="SERVLET">
  <input type="hidden" value="<%= $xml_connect_mode  %>" name="ppp_connect_mode">
</form>
</table>
</div>
</body>
</html>
